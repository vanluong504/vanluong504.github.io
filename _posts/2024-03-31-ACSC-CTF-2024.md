---
title: ACSC CTF 2024 - Writeup
date: 2024-03-31 12:00:00
categories: [CTF]
tags: [CTF,ACSC CTF 2024]
image: /assets/image/CTF/ACSC2024/logo.png
math: true
---

### RSA stream 2

``chal_redacted.py``
```python
from Crypto.Util.number import getPrime
import random
import re


p = getPrime(512)
q = getPrime(512)
e = 65537
n = p * q
d = pow(e, -1, (p - 1) * (q - 1))

m = random.randrange(2, n)
c = pow(m, e, n)

text = open(__file__, "rb").read()
ciphertext = []
for b in text:
    o = 0
    for i in range(8):
        bit = ((b >> i) & 1) ^ (pow(c, d, n) % 2)
        c = pow(2, e, n) * c % n
        o |= bit << i
    ciphertext.append(o)


open("chal.py.enc", "wb").write(bytes(ciphertext))
redacted = re.sub("flag = \"ACSC{(.*)}\"", "flag = \"ACSC{*REDACTED*}\"", text.decode())
open("chal_redacted.py", "w").write(redacted)
print("n =", n)

# flag = "ACSC{*REDACTED*}"

```
``output.txt``
```
n = 106362501554841064194577568116396970220283331737204934476094342453631371019436358690202478515939055516494154100515877207971106228571414627683384402398675083671402934728618597363851077199115947762311354572964575991772382483212319128505930401921511379458337207325937798266018097816644148971496405740419848020747
```

File ``chal.py.enc`` i convert ``chal.py.enc`` (hex)

```
186dde284886535fe929499633e8489c09cafc75a4380ac238a9da69d4afe9230474ae7d6f14c64327a1bcf56c21f87f81bf04df89ffb51eb748d8f53b18ef8ef37b7c941b9f81d62229512881596bc6ef4d40ab502ab2ea6cd43a12a08b51bac84bf9f1fc1304d954d65b8d0dcb3f9c3e84905891003f8af8144cc4e772fd4e8b0b63236885bdd6aab904710adb897dfeed330451f5e7f2b56b697e64deb64918535225322cb4145cadb1a21edbde5f166e612b00b47e32acac0247ff69056548625b736943e71587dcc7162eaefdb858875c1d85c988ef8a0523635fc19aa1b4580a1c54418b96843de8c2d276651ca1d47b5735e9c0495445156b76fc0ee7dda309ac5059a71deda2dbe5d74ea1bbd86f369cfb7dcc9808a9bab8d2dd1d91c508fa48402ba965c1204eebb23c2ed8f4149b9554716a57c87022bc63a960b0f9af396b5e83e7c2122fca1c7f526fac3432df3ca16fc08a75546dc565ee1b746745288620107a0b8fdbd6ef51fd322e97a45921f6c113b53c934d4496d7ae8c0303067a6a03a3f9527683f8b5d715002d4e6ed741bd58dabaa9bbb9f4560649556f3451d152ad7ba207260c3832305c69625df000ede196619aee916df8939d2b8df34170ab70a6a693ed1c8ebc6415b3960640f8b388c333b1e79c4dfb3c50ce61851ff04fd1d9f93b990a8d4063042da2613e68d8381ae435de05244ff98602ec2347afda95d6e151fd05efae0bd1d2704895d740e7bdf796d0480fa819f44ec17cfd6723065e5eea903f469adfd4292de18d2ed37f3952562e8ff29af0e36932703c0c130538bb154e487eb7459ed63c6f9e35a6d8df97b1ff7243d86544b387629f2f2875e7a1f2e6f14a14384114f5d78f5b8e955942cd99053d82829f9524442dd007b7be03387919075fb3c24f86285de23c7f71073632f67179d8d375b6ac6195df9cf2c194a93bd6189079398fbf389140
```
I found [RSA least significant bit oracle attack](https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack)

### strongest OAEP

``strongest_OAEP.py``
```python
from Crypto.Cipher import PKCS1_OAEP
from Crypto.PublicKey import RSA
from Crypto.Util.number import *

import os

flag = b"ACSC{___REDACTED___}"

def strongest_mask(seed, l):
  return b"\x01"*l

def strongest_random(l):
  x = bytes_to_long(os.urandom(1)) & 0b1111
  return long_to_bytes(x) + b"\x00"*(l-1)

f = open("strongest_OAEP.txt","w")

key = RSA.generate(2048,e=13337)

c_buf = -1

for a in range(2):
  OAEP_cipher = PKCS1_OAEP.new(key=key,randfunc=strongest_random,mgfunc=strongest_mask)

  while True:
    c = OAEP_cipher.encrypt(flag)
    num_c = bytes_to_long(c)
    if c_buf == -1:
      c_buf = num_c
    else:
      if c_buf == num_c:continue
    break

  f.write("c: %d\n" % num_c)
  f.write("e: %d\n" % key.e)
  f.write("n: %d\n" % key.n)

  OAEP_cipher = PKCS1_OAEP.new(key=key,randfunc=strongest_random,mgfunc=strongest_mask)
  dec = OAEP_cipher.decrypt(c)
  assert dec == flag

  # wow, e is growing!
  d = pow(31337,-1,(key.p-1)*(key.q-1))
  key = RSA.construct( ((key.p * key.q), 31337, d) ) 

# c: 13412188923056789723463018818435903148553225092126449284011226597847469180689010500205036581482811978555296731975701940914514386095136431336581120957243367238078451768890612869946983768089205994163832242140627878771251215486881255966451017190516603328744559067714544394955162613568906904076402157687419266774554282111060479176890574892499842662967399433436106374957988188845814236079719315268996258346836257944935631207495875339356537546431504038398424282614669259802592883778894712706369303231223163178823585230343236152333248627819353546094937143314045129686931001155956432949990279641294310277040402543835114017195
# e: 13337
# n: 22233043203851051987774676272268763746571769790283990272898544200595210865805062042533964757556886045816797963053708033002519963858645742763011213707135129478462451536734634098226091953644783443749078817891950148961738265304229458722767352999635541835260284887780524275481187124725906010339700293644191694221299975450383751561212041078475354616962383810736434747953002102950194180005232986331597234502395410788503785620984541020025985797561868793917979191728616579236100110736490554046863673615387080279780052885489782233323860240506950917409357985432580921304065490578044496241735581685702356948848524116794108391919
# c: 2230529887743546073042569155549981915988020442555697399569938119040296168644852392004943388395772846624890089373407560524611849742337613382094015150780403945116697313543212865635864647572114946163682794770407465011059399243683214699692137941823141772979188374817277682932504734340149359148062764412778463661066901102526545656745710424144593949190820465603686746875056179210541296436271441467169157333013539090012425649531186441705611053197011849258679004951603667840619123734153048241290299145756604698071913596927333822973487779715530623752416348064576460436025539155956034625483855558580478908137727517016804515266
# e: 31337
# n: 22233043203851051987774676272268763746571769790283990272898544200595210865805062042533964757556886045816797963053708033002519963858645742763011213707135129478462451536734634098226091953644783443749078817891950148961738265304229458722767352999635541835260284887780524275481187124725906010339700293644191694221299975450383751561212041078475354616962383810736434747953002102950194180005232986331597234502395410788503785620984541020025985797561868793917979191728616579236100110736490554046863673615387080279780052885489782233323860240506950917409357985432580921304065490578044496241735581685702356948848524116794108391919
```